# データベースドキュメント

<!-- tags: database, d1, cloudflare, migration, seed, sqlite -->

このディレクトリには、Saifuuプロジェクトのデータベース設計、マイグレーション、シード処理に関するすべてのドキュメントが含まれています。

## 📋 ドキュメント一覧

| ドキュメント | 役割 | 対象 |
|-------------|------|------|
| [シード処理ガイド](./シード処理ガイド.md) | データベース初期化・テストデータ投入方法 | **必須** - 全開発者 |
| [カテゴリマイグレーションガイド](./カテゴリマイグレーションガイド.md) | カテゴリ管理システムの移行手順 | **参考** - 既存データ移行時 |
| [D1マイグレーション戦略](./d1-migration-strategy.md) | Cloudflare D1への移行戦略・技術詳細 | **参考** - アーキテクチャ理解 |
| [D1マイグレーション成功](./d1-migration-success.md) | D1移行の成功事例・レポート | **参考** - 実装完了記録 |

## 🗄️ データベース構成

### 現在の技術スタック

- **ORM**: Drizzle ORM
- **開発環境DB**: Cloudflare D1 (ローカル)
- **本番環境DB**: Cloudflare D1 (リモート)
- **マイグレーション管理**: Drizzle Kit + Wrangler

### 主要テーブル

- `categories` - カテゴリマスター（現在は設定ファイル管理へ移行）
- `subscriptions` - サブスクリプション情報
- `transactions` - 取引履歴（支出・収入）

## 🚀 クイックスタート

### 開発環境のデータベース初期化

```bash
# 1. 開発環境セットアップ（推奨）
npm run db:setup:dev

# 2. または完全リセット
npm run db:reset:dev

# 3. データベース確認
npm run db:studio
```

### マイグレーション操作

```bash
# マイグレーション生成
npm run db:generate

# ローカル適用
npm run db:migrate:local

# 本番適用（注意して実行）
npm run db:migrate:remote
```

## 📊 データ管理

### シードデータ

開発環境では以下のテストデータが自動投入されます：

- **カテゴリ**: 8種類の支出カテゴリ
- **サブスクリプション**: 5件のサンプルデータ（Netflix、Spotify等）

詳細は[シード処理ガイド](./シード処理ガイド.md)を参照してください。

### カテゴリ管理の変更

カテゴリ管理がデータベースから設定ファイル（`shared/config/categories.ts`）へ移行されました。既存データの移行方法は[カテゴリマイグレーションガイド](./カテゴリマイグレーションガイド.md)を参照してください。

## ⚠️ 注意事項

### 環境分離

- **開発環境**: ローカルD1 (`.wrangler/state/v3/d1/`)
- **テスト環境**: 専用のテストDB
- **本番環境**: Cloudflare D1リモート

各環境のデータは完全に分離されており、相互に影響しません。

### マイグレーション実行時の注意

1. **本番マイグレーション前**: 必ずバックアップを取得
2. **スキーマ変更時**: まずローカルで検証
3. **データ移行時**: 既存データへの影響を確認

## 🔄 関連ドキュメント

- **開発環境**: [../開発環境/](../開発環境/) - 環境セットアップ
- **API開発**: [../API開発/](../API開発/) - APIエンドポイント実装
- **テスト**: [../テスト/](../テスト/) - データベーステスト戦略

---

**💡 ヒント**: データベース関連で新しいドキュメントを作成する場合は、このディレクトリに配置し、上記の一覧表を更新してください。