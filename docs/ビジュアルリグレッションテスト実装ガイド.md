# ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

issue-32ã€ŒStorybookã‚’æ´»ç”¨ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›å¸°ãƒ†ã‚¹ãƒˆã®setupã€ã«é–¢ã™ã‚‹èª¿æŸ»çµæœã¨å®Ÿè£…æ–¹é‡ã‚’ã¾ã¨ã‚ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯æ—¢ã«Storybook v8.6.14ã€Playwright v1.53.1ã€@storybook/test v8.6.14ãŒè¨­å®šæ¸ˆã¿ã§ã‚ã‚Šã€ã“ã‚Œã‚‰ã®æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ã‚’æ´»ç”¨ã—ã¦ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã§ãã¾ã™ã€‚

## ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³

### æ—¢å­˜è¨­å®š
- **Storybook**: v8.6.14ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå¯¾å¿œï¼‰
- **Playwright**: v1.53.1ï¼ˆç¾åœ¨ãƒ­ãƒ¼ã‚«ãƒ«å°‚ç”¨ã€CIç„¡åŠ¹ï¼‰
- **@storybook/test**: v8.6.14ï¼ˆã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå¯¾å¿œï¼‰
- **MSW**: v2.10.2ï¼ˆAPIãƒ¢ãƒƒã‚¯ï¼‰
- **Vitest**: v3.2.4ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰

### CI/CDçŠ¶æ³
- GitHub Actionsã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå¿…è¦ï¼ˆ`.github`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæœªå­˜åœ¨ï¼‰
- E2Eãƒ†ã‚¹ãƒˆã¯ç„¡æ–™æ ç¯€ç´„ã®ãŸã‚ç¾åœ¨ç„¡åŠ¹åŒ–
- ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ä½¿ç”¨ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹è¨­å®šï¼‰

## å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ¯”è¼ƒ

## Vitestãƒ™ãƒ¼ã‚¹ï¼ˆçµ±åˆç’°å¢ƒé‡è¦–ï¼‰

ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒVitestãƒ™ãƒ¼ã‚¹ã®ãŸã‚ã€ä»¥ä¸‹ã®Vitestçµ±åˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å„ªå…ˆçš„ã«æ¤œè¨ã—ã¾ã™ã€‚

### 1. ğŸš€ ã€NEWæ¨å¥¨ã€‘storybook-addon-vis + Vitest

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **Vitestçµ±åˆ**: æ—¢å­˜ã®Vitestç’°å¢ƒã¨å®Œå…¨çµ±åˆ
- âœ… **ç¾ä»£çš„**: 2025å¹´ã®æœ€æ–°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€TypeScriptå®Œå…¨å¯¾å¿œ
- âœ… **è‡ªå‹•ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ**: `snapshot`ã‚¿ã‚°ã§è‡ªå‹•ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- âœ… **Storybook UI**: Storybookã®è¦–è¦šçš„ãƒ†ã‚¹ãƒˆã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ç›´æ¥å®Ÿè¡Œãƒ»ç¢ºèª
- âœ… **ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¢ãƒ¼ãƒ‰**: Vitest Browser Modeã§å®Ÿãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
- âœ… **ã‚³ã‚¹ãƒˆ**: å®Œå…¨ç„¡æ–™ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **å®Ÿé¨“çš„**: æ¯”è¼ƒçš„æ–°ã—ã„ã‚¢ãƒ‰ã‚ªãƒ³ã®ãŸã‚ã€å®Ÿç¸¾ãŒå°‘ãªã„
- âŒ **ä¾å­˜é–¢ä¿‚**: Vitest Browser Modeï¼ˆå®Ÿé¨“çš„æ©Ÿèƒ½ï¼‰ã«ä¾å­˜
- âŒ **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ç¿’å¾—ãŒå¿…è¦

#### æ‰‹å‹•è¨­å®šè¦ä»¶
1. `storybook-addon-vis` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. `@storybook/addon-vitest` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆStorybook Testç”¨ï¼‰
3. Vitestè¨­å®šã®æ‹¡å¼µï¼ˆBrowser Mode + vis pluginï¼‰
4. Storybookãƒ¡ã‚¤ãƒ³è¨­å®šã¸ã®ä¸¡ã‚¢ãƒ‰ã‚ªãƒ³è¿½åŠ 
5. ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¸ã®`snapshot`ã‚¿ã‚°ä»˜ä¸

#### å®Ÿè£…ä¾‹
```typescript
// vitest.config.tsï¼ˆæ‹¡å¼µç‰ˆï¼‰
import { storybookTest } from '@storybook/addon-vitest/vitest-plugin'
import { storybookVis } from 'storybook-addon-vis/vitest-plugin'
import { defineConfig } from 'vitest/config'
import path from "node:path"
import react from "@vitejs/plugin-react"

export default defineConfig({
  plugins: [
    react(),
    storybookTest(),
    storybookVis({
      snapshotRootDir: ({ ci }) => ci ? '__vis__/ci' : '__vis__/local',
    })
  ],
  resolve: {
    alias: { "@": path.resolve(__dirname, "./src") },
  },
  test: {
    environment: "jsdom", // ã¾ãŸã¯ browser mode
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chromium',
    },
    setupFiles: ['./vitest.setup.ts'],
    globals: false,
    // æ—¢å­˜è¨­å®šã‚’ç¶™æ‰¿
  },
})
```

```typescript
// vitest.setup.tsï¼ˆæ‹¡å¼µç‰ˆï¼‰
import { beforeAll } from 'vitest'
import { setProjectAnnotations } from '@storybook/react'
import { vis, visAnnotations } from 'storybook-addon-vis/vitest-setup'
import * as projectAnnotations from './.storybook/preview'

const project = setProjectAnnotations([
  visAnnotations,
  projectAnnotations
])

vis.setup()
beforeAll(project.beforeAll)
```

```typescript
// .storybook/main.tsï¼ˆæ‹¡å¼µç‰ˆï¼‰
import type { StorybookConfig } from "@storybook/nextjs";

const config: StorybookConfig = {
  stories: ["../src/**/*.mdx", "../src/**/*.stories.@(js|jsx|mjs|ts|tsx)"],
  addons: [
    "@storybook/addon-essentials",
    "@storybook/addon-a11y",
    "@storybook/addon-viewport",
    "msw-storybook-addon",
    "storybook-addon-vis",      // è¿½åŠ 
    "@storybook/addon-vitest",  // è¿½åŠ 
  ],
  framework: {
    name: "@storybook/nextjs",
    options: {},
  },
  staticDirs: ["../public"],
};
export default config;
```

---

### 2. ğŸ”§ composeStories + Vitest + Custom Visual Testing

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **Vitestçµ±åˆ**: å®Œå…¨ã«Vitestç’°å¢ƒã§å‹•ä½œ
- âœ… **ãƒãƒ¼ã‚¿ãƒ–ãƒ«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼**: å…¬å¼ã®portable stories APIæ´»ç”¨
- âœ… **ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**: ç‹¬è‡ªã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…å¯èƒ½
- âœ… **DOM/Visual**: DOMã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã‹ã‚‰ç”»åƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã¾ã§å¯¾å¿œ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **å®Ÿè£…ã‚³ã‚¹ãƒˆ**: ã‚«ã‚¹ã‚¿ãƒ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ãŒå¿…è¦
- âŒ **ä¿å®ˆè² è·**: ç‹¬è‡ªå®Ÿè£…ã®ãŸã‚é•·æœŸä¿å®ˆãŒèª²é¡Œ
- âŒ **ãƒ„ãƒ¼ãƒ«çµ±åˆ**: ç”»åƒæ¯”è¼ƒãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ¥é€”çµ±åˆãŒå¿…è¦

#### å®Ÿè£…ä¾‹
```typescript
// src/__tests__/visual-regression.test.ts
import { render } from '@testing-library/react'
import { composeStories } from '@storybook/react'
import { expect, test, describe } from 'vitest'
import * as ButtonStories from '../components/Button.stories'

const { Primary, Secondary } = composeStories(ButtonStories)

describe('Button Visual Tests', () => {
  test('Primary button visual snapshot', async () => {
    const { container } = render(<Primary />)
    
    // DOMã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
    expect(container.firstChild).toMatchSnapshot()
    
    // TODO: ç”»åƒã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼ˆè¦ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ï¼‰
    // const screenshot = await captureElementScreenshot(container.firstChild)
    // expect(screenshot).toMatchImageSnapshot()
  })
})
```

---

### 3. ğŸ­ Vitest Browser Mode + Playwright Component Testing

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **å®Ÿãƒ–ãƒ©ã‚¦ã‚¶**: å®Ÿéš›ã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- âœ… **Playwrightçµ±åˆ**: æ—¢å­˜Playwrightè¨­å®šã®æ´»ç”¨
- âœ… **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**: E2Eã¨Unit testã®ä¸­é–“çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- âœ… **é«˜ç²¾åº¦**: å®Ÿãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æ­£ç¢ºãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¤œè¨¼

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **å®Ÿé¨“çš„**: Vitest Browser ModeãŒå®Ÿé¨“çš„æ©Ÿèƒ½
- âŒ **è¤‡é›‘æ€§**: è¨­å®šã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¤‡é›‘
- âŒ **åˆæœŸåŒ–æ™‚é–“**: ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ã«ã‚ˆã‚‹å®Ÿè¡Œæ™‚é–“ã®å¢—åŠ 

#### å®Ÿè£…ä¾‹
```typescript
// vitest.config.tsï¼ˆBrowser Modeç‰ˆï¼‰
export default defineConfig({
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chromium',
    },
    // ...æ—¢å­˜è¨­å®š
  },
})
```

---

## Jestãƒ™ãƒ¼ã‚¹ï¼ˆå¾“æ¥ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

### 4. ğŸ¯ Storybook Test Runner + jest-image-snapshot

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **æ—¢å­˜ã‚¤ãƒ³ãƒ•ãƒ©æ´»ç”¨**: ç¾åœ¨ã®Storybookè¨­å®šã‚’ãã®ã¾ã¾åˆ©ç”¨
- âœ… **çµ±åˆã—ã‚„ã™ã•**: Storybookã®Test Runnerã¨å®Œå…¨çµ±åˆ
- âœ… **ã‚³ã‚¹ãƒˆ**: å®Œå…¨ç„¡æ–™ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹
- âœ… **å­¦ç¿’ã‚³ã‚¹ãƒˆ**: æ—¢å­˜ã®Storybookãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‹ã‚‰è‡ªç„¶ãªæ‹¡å¼µ
- âœ… **CIçµ±åˆ**: GitHub Actionsã¨ã®è¦ªå’Œæ€§ãŒé«˜ã„
- âœ… **è¨­å®šã®æŸ”è»Ÿæ€§**: Jestè¨­å®šã§è©³ç´°ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¨CIç’°å¢ƒã®æº–å‚™ãŒå¿…è¦
- âŒ **ä¿å®ˆä½œæ¥­**: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç”»åƒã®ç®¡ç†ãŒæ‰‹å‹•
- âŒ **ãƒ¬ãƒ“ãƒ¥ãƒ¼UI**: å·®åˆ†ç¢ºèªã¯åŸºæœ¬çš„ã«CLIã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹

#### æ‰‹å‹•è¨­å®šè¦ä»¶
1. `@storybook/test-runner`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. `jest-image-snapshot`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. `.storybook/test-runner.ts`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
4. GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®šï¼ˆ`.github/workflows/`ï¼‰
5. ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š

#### CIè¨­å®šä¾‹
```typescript
// .storybook/test-runner.ts
import { TestRunnerConfig, waitForPageReady } from '@storybook/test-runner';
import { toMatchImageSnapshot } from 'jest-image-snapshot';

const config: TestRunnerConfig = {
  setup() {
    expect.extend({ toMatchImageSnapshot });
  },
  async postVisit(page, context) {
    await waitForPageReady(page);
    const image = await page.screenshot();
    expect(image).toMatchImageSnapshot({
      customSnapshotsDir: `${process.cwd()}/__snapshots__`,
      customSnapshotIdentifier: context.id,
    });
  },
};
export default config;
```

---

### 2. ğŸ¢ Chromaticï¼ˆStorybookå…¬å¼ï¼‰

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **å…¬å¼ã‚µãƒãƒ¼ãƒˆ**: Storybookãƒãƒ¼ãƒ ãŒé–‹ç™ºãƒ»ä¿å®ˆ
- âœ… **çµ±åˆåº¦**: Storybook UIã¨å®Œå…¨çµ±åˆ
- âœ… **ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶**: Chromeã€Firefoxã€Safariã€Edgeã§ã®ä¸¦åˆ—ãƒ†ã‚¹ãƒˆ
- âœ… **ã‚¯ãƒ©ã‚¦ãƒ‰**: ã‚¤ãƒ³ãƒ•ãƒ©ä¸è¦ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼UIãŒå……å®Ÿ
- âœ… **ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã¨ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å”åƒãŒå®¹æ˜“

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **ã‚³ã‚¹ãƒˆ**: $149/æœˆã€œï¼ˆç„¡æ–™æ : 5,000ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ/æœˆï¼‰
- âŒ **ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³**: Chromaticä¾å­˜
- âŒ **åˆ¶ç´„**: Storybookã®ã¿å¯¾è±¡ï¼ˆE2Eä¸å¯ï¼‰

#### æ‰‹å‹•è¨­å®šè¦ä»¶
1. Chromaticã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
2. `@chromatic-com/storybook`ã‚¢ãƒ‰ã‚ªãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒˆãƒ¼ã‚¯ãƒ³ã®ç’°å¢ƒå¤‰æ•°è¨­å®š
4. GitHub Actionsã§ã®chromaticå…¬é–‹è¨­å®š

---

### 3. ğŸ­ Playwright Visual Comparisons

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **æ—¢å­˜æ´»ç”¨**: ç¾åœ¨ã®Playwrightè¨­å®šã‚’æ‹¡å¼µ
- âœ… **é«˜æ€§èƒ½**: ä¸¦åˆ—å®Ÿè¡Œã¨ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§é«˜é€Ÿ
- âœ… **æŸ”è»Ÿæ€§**: E2Eã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ãƒšãƒ¼ã‚¸å…¨ã¦ã«å¯¾å¿œ
- âœ… **ç²¾å¯†åˆ¶å¾¡**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç¯„å›²ã‚„ãƒã‚¹ã‚­ãƒ³ã‚°ã®è©³ç´°è¨­å®š

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **è¤‡é›‘æ€§**: E2Eã¨ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆã®è¨­å®šã‚’åˆ†é›¢ç®¡ç†
- âŒ **Storybookçµ±åˆ**: ç›´æ¥çµ±åˆã«ã¯è¿½åŠ è¨­å®šãŒå¿…è¦
- âŒ **CIåˆ¶ç´„**: ç¾åœ¨ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹E2Eç’°å¢ƒã®å†æœ‰åŠ¹åŒ–ãŒå¿…è¦

#### æ‰‹å‹•è¨­å®šè¦ä»¶
1. E2E ãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å†æœ‰åŠ¹åŒ–æ¤œè¨
2. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆå°‚ç”¨ã®Playwrightè¨­å®š
3. GitHub Actionsç’°å¢ƒã§ã®ä¸€è²«æ€§ç¢ºä¿è¨­å®š

---

### 4. ğŸ”§ BackstopJS

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **ã‚·ãƒ³ãƒ—ãƒ«**: è¨­å®šãŒç›´æ„Ÿçš„
- âœ… **ç„¡æ–™**: ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹
- âœ… **Dockerå¯¾å¿œ**: ç’°å¢ƒä¸€è²«æ€§ã®ç¢ºä¿ãŒå®¹æ˜“
- âœ… **ãƒ¬ãƒãƒ¼ãƒˆ**: HTMLãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **Storybookçµ±åˆ**: è¿½åŠ è¨­å®šãŒè¤‡é›‘
- âŒ **ä¿å®ˆ**: é•·æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹è² è·
- âŒ **ãƒ¢ãƒ€ãƒ³ã•**: ä»–ãƒ„ãƒ¼ãƒ«ã¨æ¯”è¼ƒã—ã¦æ©Ÿèƒ½ãŒé™å®šçš„

---

### 5. ğŸš€ Lost Pixelï¼ˆ2025å¹´æ³¨ç›®æ ªï¼‰

#### ãƒ¡ãƒªãƒƒãƒˆ
- âœ… **ç¾ä»£çš„**: TypeScriptå®Œå…¨å¯¾å¿œã€ãƒ¢ãƒ€ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- âœ… **å¤šæ©Ÿèƒ½**: Storybook + E2E + ãƒšãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆã®çµ±åˆ
- âœ… **ç„¡æ–™**: ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ç‰ˆã§åŸºæœ¬æ©Ÿèƒ½åˆ©ç”¨å¯èƒ½
- âœ… **UI**: æœ‰æ–™ç‰ˆã§ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼UIæä¾›
- âœ… **GitHubçµ±åˆ**: GitHub Actionså°‚ç”¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æä¾›

#### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
- âŒ **æ–°ã—ã•**: æ¯”è¼ƒçš„æ–°ã—ã„ãŸã‚äº‹ä¾‹ãŒå°‘ãªã„
- âŒ **å­¦ç¿’**: æ–°ã—ã„ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã®ç¿’å¾—ãŒå¿…è¦
- âŒ **åˆ¶ç´„**: GitHubã®ã¿ã‚µãƒãƒ¼ãƒˆï¼ˆGitLabç­‰ä¸å¯ï¼‰

#### æ‰‹å‹•è¨­å®šè¦ä»¶
1. `lost-pixel`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. `lostpixel.config.ts`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
3. GitHub Actionsã§ã®lost-pixel/lost-pixel@v3.22.0ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š

---

### 6. ğŸ’° ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹æ¯”è¼ƒï¼ˆPercy vs Applitoolsï¼‰

#### Percyï¼ˆby BrowserStackï¼‰
**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… é€æ˜ãªä¾¡æ ¼è¨­å®šï¼ˆç„¡æ–™æ : 5,000ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ/æœˆï¼‰
- âœ… BrowserStackã®ä¿¡é ¼æ€§ã¨ã‚¤ãƒ³ãƒ•ãƒ©

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ æœˆé¡ã‚³ã‚¹ãƒˆï¼ˆæœ‰æ–™ãƒ—ãƒ©ãƒ³å¿…è¦ï¼‰

#### Applitools
**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… AIé§†å‹•ã®é«˜ç²¾åº¦diffæ¤œå‡º
- âœ… ä¼æ¥­å‘ã‘æ©Ÿèƒ½ãŒå……å®Ÿ

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- âŒ ä¾¡æ ¼éå…¬é–‹ï¼ˆå–¶æ¥­å•ã„åˆã‚ã›å¿…é ˆï¼‰
- âŒ é«˜ã‚³ã‚¹ãƒˆï¼ˆå¤§ä¼æ¥­å‘ã‘ï¼‰

---

## æ¨å¥¨å®Ÿè£…æˆ¦ç•¥

### æ®µéšçš„å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

#### ãƒ•ã‚§ãƒ¼ã‚º1: Vitestãƒ™ãƒ¼ã‚¹å°å…¥ï¼ˆNEWæ¨å¥¨ï¼‰
1. **storybook-addon-vis + Vitest**ã‚’é¸æŠ
2. ç†ç”±ï¼š
   - æ—¢å­˜ã®Vitestç’°å¢ƒã¨å®Œå…¨çµ±åˆ
   - ç¾ä»£çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å°†æ¥æ€§ãŒé«˜ã„
   - Storybook UIã§ã®ç›´æ„Ÿçš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   - å®Œå…¨ç„¡æ–™
   - å®Ÿãƒ–ãƒ©ã‚¦ã‚¶ã§ã®æ­£ç¢ºãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¤œè¨¼

#### ãƒ•ã‚§ãƒ¼ã‚º2: æ¤œè¨¼ãƒ»æ‹¡å¼µ
- é‹ç”¨ã‚’é€šã˜ã¦Vitest Browser Modeã®å®‰å®šæ€§ç¢ºèª
- å¿…è¦ã«å¿œã˜ã¦Jestãƒ™ãƒ¼ã‚¹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆTest Runnerï¼‰ã¸ã®ç§»è¡Œæ¤œè¨
- ã¾ãŸã¯Chromaticï¼ˆäºˆç®—ãŒã‚ã‚‹å ´åˆï¼‰ã¸ã®ç§»è¡Œæ¤œè¨

#### ãƒ•ã‚§ãƒ¼ã‚º3: æœ€é©åŒ–
- CI/CDçµ±åˆã®æœ€é©åŒ–
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç®¡ç†ã®è‡ªå‹•åŒ–
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ”¹å–„

## å®Ÿè£…æ‰‹é †ï¼ˆNEWæ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—1: å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
npm install --save-dev storybook-addon-vis @storybook/addon-vitest
```

### ã‚¹ãƒ†ãƒƒãƒ—2: Vitestè¨­å®šã®æ‹¡å¼µ
```typescript
// vitest.config.tsï¼ˆæ—¢å­˜è¨­å®šã«è¿½åŠ ï¼‰
import { storybookTest } from '@storybook/addon-vitest/vitest-plugin'
import { storybookVis } from 'storybook-addon-vis/vitest-plugin'
import { defineConfig } from 'vitest/config'
import path from "node:path"
import react from "@vitejs/plugin-react"

export default defineConfig({
  plugins: [
    react(),
    storybookTest(),
    storybookVis({
      snapshotRootDir: ({ ci }) => ci ? '__vis__/ci' : '__vis__/local',
    })
  ],
  resolve: {
    alias: { "@": path.resolve(__dirname, "./src") },
  },
  test: {
    environment: "jsdom",
    browser: {
      enabled: true,
      provider: 'playwright',
      name: 'chromium',
    },
    setupFiles: ['./vitest.setup.ts'],
    globals: false,
    include: ["src/**/*.{test,spec}.{js,mjs,cjs,ts,mts,cts,jsx,tsx}"],
    exclude: ["tests/**", "node_modules/**", ".next/**"],
    // æ—¢å­˜ã®coverageè¨­å®šã‚’ç¶™æ‰¿
    coverage: {
      provider: "v8",
      reporter: ["text", "json", "json-summary", "html"],
      exclude: [
        "node_modules/**",
        "tests/**",
        "**/*.test.{js,mjs,cjs,ts,mts,cts,jsx,tsx}",
        "**/*.spec.{js,mjs,cjs,ts,mts,cts,jsx,tsx}",
        "**/*.stories.{js,mjs,cjs,ts,mts,cts,jsx,tsx}",
        "**/*.config.{js,mjs,cjs,ts,mts,cts}",
        "**/types/**",
        "**/*.d.ts",
        ".next/**",
        "storybook-static/**",
        "__vis__/**", // Visual test snapshots
      ],
      include: ["src/**/*.{js,mjs,cjs,ts,mts,cts,jsx,tsx}"],
      thresholds: {
        global: {
          branches: 80,
          functions: 80,
          lines: 80,
          statements: 80,
        },
      },
    },
  },
});
```

### ã‚¹ãƒ†ãƒƒãƒ—3: Vitest ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µ
```typescript
// vitest.setup.tsï¼ˆæ—¢å­˜è¨­å®šã«è¿½åŠ ï¼‰
import { beforeAll } from 'vitest'
import { setProjectAnnotations } from '@storybook/react'
import { vis, visAnnotations } from 'storybook-addon-vis/vitest-setup'
import * as projectAnnotations from './.storybook/preview'

// Apply Storybook project annotations
const project = setProjectAnnotations([
  visAnnotations, // Add visual testing annotations
  projectAnnotations
])

// Setup vis lifecycle
vis.setup()

beforeAll(project.beforeAll)
```

### ã‚¹ãƒ†ãƒƒãƒ—4: Storybookè¨­å®šã®æ‹¡å¼µ
```typescript
// .storybook/main.tsï¼ˆæ—¢å­˜è¨­å®šã«è¿½åŠ ï¼‰
import type { StorybookConfig } from "@storybook/nextjs";

const config: StorybookConfig = {
  stories: ["../src/**/*.mdx", "../src/**/*.stories.@(js|jsx|mjs|ts|tsx)"],
  addons: [
    "@storybook/addon-essentials",
    "@storybook/addon-a11y",
    "@storybook/addon-viewport",
    "msw-storybook-addon",
    "storybook-addon-vis",      // è¿½åŠ 
    "@storybook/addon-vitest",  // è¿½åŠ 
  ],
  framework: {
    name: "@storybook/nextjs",
    options: {},
  },
  staticDirs: ["../public"],
};
export default config;
```

### ã‚¹ãƒ†ãƒƒãƒ—5: ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆæœ‰åŠ¹åŒ–
```typescript
// ä¾‹: src/components/ui/Dialog.stories.tsx
export default {
  title: 'Components/ui/Dialog',
  component: Dialog,
  // ã™ã¹ã¦ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆã‚’æœ‰åŠ¹åŒ–
  tags: ['snapshot'],
}

// ã¾ãŸã¯å€‹åˆ¥ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§æœ‰åŠ¹åŒ–
export const Default = {
  tags: ['snapshot'],
  args: {
    // ... existing args
  },
}
```

### ã‚¹ãƒ†ãƒƒãƒ—6: package.json ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ 
```json
{
  "scripts": {
    "test:visual": "vitest run --browser", 
    "test:visual:watch": "vitest --browser",
    "test:visual:ui": "vitest --ui --browser"
  }
}
```

### ã‚¹ãƒ†ãƒƒãƒ—7: .gitignoreã®æ›´æ–°
```gitignore
# Visual regression test artifacts
__vis__/
!__vis__/ci/__baselines__
!__vis__/local/__baselines__
```

## é‹ç”¨ä¸Šã®è€ƒæ…®äº‹é …

### ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç®¡ç†
- **åˆå›å®Ÿè¡Œ**: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã®ç”Ÿæˆ
- **æ›´æ–°**: æ„å›³çš„ãªå¤‰æ›´æ™‚ã®`--updateSnapshot`å®Ÿè¡Œ
- **ãƒ¬ãƒ“ãƒ¥ãƒ¼**: å·®åˆ†ç”»åƒã®ç›®è¦–ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹

### CI/CDçµ±åˆ
- **ä¸¦åˆ—å®Ÿè¡Œ**: ãƒ†ã‚¹ãƒˆæ™‚é–“çŸ­ç¸®ã®ãŸã‚ã®ã‚·ãƒ£ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ**: å¤±æ•—æ™‚ã®å·®åˆ†ç”»åƒä¿å­˜
- **é€šçŸ¥**: Slack/Teamsé€£æºã§ã®çµæœé€šçŸ¥

### ãƒãƒ¼ãƒ é‹ç”¨
- **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ‰¿èª**: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®å·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹
- **ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼é€£æº**: è¦–è¦šçš„å¤‰æ›´ã®äº‹å‰æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆæ›´æ–°ã®æ‰‹é †æ›¸

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®äº‹é …

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã«æ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œãªã„ã‚ˆã†æ³¨æ„
- ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨å¾¹åº•
- Secretsç®¡ç†ï¼ˆAPI keyç­‰ã®é©åˆ‡ãªç®¡ç†ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ç„¡æ–™æ åˆ¶ç´„ä¸‹ã§ã®ãƒ†ã‚¹ãƒˆå¯¾è±¡ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®é¸åˆ¥
- ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã§ã®å®Ÿè¡Œæ™‚é–“æœ€é©åŒ–
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆç¾åœ¨ç„¡åŠ¹ã ãŒå°†æ¥çš„ãªæ¤œè¨ï¼‰

## çµè«–

ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³ï¼ˆVitest v3.2.4ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒï¼‰ã‚’è€ƒæ…®ã™ã‚‹ã¨ã€**storybook-addon-vis + Vitest**ã«ã‚ˆã‚‹å®Ÿè£…ãŒæœ€é©è§£ã§ã™ã€‚

### é¸å®šç†ç”±
1. **ãƒ†ã‚¹ãƒˆçµ±åˆ**: æ—¢å­˜ã®Vitestãƒ†ã‚¹ãƒˆç’°å¢ƒã¨å®Œå…¨çµ±åˆ
2. **ç¾ä»£æ€§**: 2025å¹´ã®æœ€æ–°ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§å°†æ¥æ€§ãŒé«˜ã„
3. **Storybookçµ±åˆ**: Storybook UIã§ã®ç›´æ„Ÿçš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»ç¢ºèª
4. **å®Ÿãƒ–ãƒ©ã‚¦ã‚¶**: Vitest Browser Modeã«ã‚ˆã‚‹æ­£ç¢ºãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¤œè¨¼
5. **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: å®Œå…¨ç„¡æ–™ã§é‹ç”¨å¯èƒ½
6. **æ®µéšçš„å°å…¥**: å°ã•ãå§‹ã‚ã¦å¾ã€…ã«æ‹¡å¼µå¯èƒ½

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¡ˆ
ã‚‚ã—Vitest Browser Modeï¼ˆå®Ÿé¨“çš„æ©Ÿèƒ½ï¼‰ã®å®‰å®šæ€§ã«æ‡¸å¿µãŒã‚ã‚‹å ´åˆã¯ã€å¾“æ¥ã®**Storybook Test Runner + jest-image-snapshot**ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚‚æœ‰åŠ¹ã§ã™ã€‚

### Next Steps
1. **Phase 1**: storybook-addon-visã«ã‚ˆã‚‹Vitestçµ±åˆå®Ÿè£…
2. **Phase 2**: å°‘æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆDialog, Buttonç­‰ï¼‰ã§ã®PoCå®Ÿæ–½  
3. **Phase 3**: ãƒãƒ¼ãƒ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨é‹ç”¨ãƒ—ãƒ­ã‚»ã‚¹ã®ç¢ºç«‹
4. **Phase 4**: æ®µéšçš„ãªå¯¾è±¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ‹¡å¤§
5. **Phase 5**: CIçµ±åˆã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æœ€é©åŒ–

### æŠ€è¡“çš„å„ªä½æ€§
- **çµ±ä¸€ç’°å¢ƒ**: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆã‚’åŒä¸€ã®Vitestãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§å®Ÿè¡Œ
- **é–‹ç™ºåŠ¹ç‡**: Storybookã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨Vitest UIã§ã®çµæœç¢ºèªãŒå¯èƒ½
- **ä¿å®ˆæ€§**: å˜ä¸€ã®ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã‚ˆã‚‹è¨­å®šãƒ»ä¾å­˜é–¢ä¿‚ã®ç°¡ç´ åŒ–

---

**ä½œæˆæ—¥**: 2025å¹´7æœˆ6æ—¥  
**å¯¾è±¡Issue**: #32  
**ãƒ–ãƒ©ãƒ³ãƒ**: issue-32  
**èª¿æŸ»å®Ÿæ–½è€…**: Claude Code