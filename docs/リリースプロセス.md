# リリースプロセス

## 概要

Saifuuプロジェクトのリリースプロセスを標準化し、品質を保ちながら安全にリリースを行うための手順を定義します。

## リリースサイクル

### リリースタイプ

1. **定期リリース**
   - 月1回の定期リリース（毎月第1週）
   - 計画的な機能追加とバグ修正

2. **ホットフィックス**
   - 緊急のバグ修正
   - セキュリティ脆弱性対応
   - 即座にリリース

3. **プレリリース**
   - alpha/beta版のリリース
   - 限定的なテスト目的

## リリース準備

### 1. リリースブランチの作成

```bash
# mainブランチから作成
git checkout main
git pull origin main
git checkout -b release/v1.0.0

# プレリリースの場合
git checkout -b release/v1.0.0-beta.1
```

### 2. バージョン更新

#### package.jsonの更新

```bash
# ルートディレクトリで実行（将来実装予定）
# 全サブプロジェクトのバージョンを統一更新
pnpm version minor  # 1.0.0 → 1.1.0
```

現在は手動で更新：
- `frontend/package.json`
- `api/package.json`（バージョン追加）
- ルート`package.json`（作成予定）

### 3. CHANGELOG更新

```markdown
# CHANGELOG.md

## [1.1.0] - 2025-01-10

### Added
- 支出管理メインページの実装 (#93)
- サブスクリプション管理機能 (#85)

### Changed
- UIコンポーネントのリファクタリング (#92)

### Fixed
- ログイン時のエラーハンドリング修正 (#91)

### Security
- 依存関係のセキュリティアップデート
```

### 4. テスト実施

#### 必須テスト

```bash
# 1. ユニットテスト
pnpm run test:unit

# 2. 型チェック・リント
pnpm run check:fix

# 3. E2Eテスト（ローカル環境）
cd e2e && pnpm run test:e2e

# 4. ビルドテスト
pnpm run build
```

#### 手動テスト

- [ ] 主要機能の動作確認
- [ ] レスポンシブデザイン確認
- [ ] ブラウザ互換性確認
- [ ] パフォーマンステスト

### 5. リリースノート作成

```markdown
# Release Notes v1.1.0

## 新機能
- 🎉 支出管理機能を追加しました
- 📊 ダッシュボードに月次レポートを追加

## 改善
- ⚡ ページ読み込み速度を30%改善
- 🎨 UIデザインを刷新

## バグ修正
- 🐛 ログイン時のエラーを修正
- 🔧 データ同期の問題を解決

## 既知の問題
- Safari でのレイアウト崩れ（次回リリースで対応予定）
```

## リリース実行

### 1. PRマージ

```bash
# リリースブランチからmainへのPR作成
gh pr create \
  --base main \
  --head release/v1.1.0 \
  --title "Release v1.1.0" \
  --body "$(cat docs/release-notes/v1.1.0.md)"
```

レビュー・承認後にマージ

### 2. タグ作成

```bash
# mainブランチに移動
git checkout main
git pull origin main

# タグ作成
git tag -a v1.1.0 -m "Release version 1.1.0"

# タグをプッシュ
git push origin v1.1.0
```

### 3. GitHub Release作成

```bash
# GitHub CLIを使用
gh release create v1.1.0 \
  --title "Release v1.1.0" \
  --notes-file docs/release-notes/v1.1.0.md \
  --target main
```

または、GitHub UIから手動作成

### 4. デプロイ

#### 本番環境デプロイ

```bash
# 現在は手動デプロイ
pnpm run deploy:manual

# 将来的にはタグプッシュで自動デプロイ
```

#### デプロイ確認

- [ ] Cloudflare Workersのデプロイログ確認
- [ ] 本番環境での動作確認
- [ ] ヘルスチェックエンドポイント確認

## リリース後作業

### 1. 監視

リリース後24時間は特に注意：

- エラー率の監視
- パフォーマンス指標の確認
- ユーザーフィードバックの収集

### 2. アナウンス

- GitHubリリースページ
- プロジェクトWiki（あれば）
- Slack/Discord（チーム利用時）

### 3. 次期開発準備

```bash
# 開発ブランチの準備
git checkout main
git pull origin main

# 新しいマイルストーン作成
# Issue整理とプランニング
```

## ホットフィックス手順

緊急修正が必要な場合：

### 1. ホットフィックスブランチ

```bash
# 本番タグから作成
git checkout -b hotfix/v1.1.1 v1.1.0
```

### 2. 修正実装

- 最小限の変更
- 必須テストのみ実施
- 迅速なレビュー

### 3. リリース

```bash
# バージョン更新（PATCHのみ）
pnpm version patch  # 1.1.0 → 1.1.1

# タグ作成・プッシュ
git tag -a v1.1.1 -m "Hotfix: Critical bug fix"
git push origin v1.1.1

# 即座にデプロイ
pnpm run deploy:manual
```

### 4. mainへの反映

```bash
# hotfixをmainにマージ
git checkout main
git merge hotfix/v1.1.1
git push origin main
```

## 自動化ロードマップ

### Phase 1（現在）
- 手動リリースプロセス
- 基本的なCI/CD

### Phase 2（3ヶ月後）
- semantic-releaseの導入
- 自動バージョニング
- CHANGELOG自動生成

### Phase 3（6ヶ月後）
- 完全自動デプロイ
- カナリアリリース
- ロールバック自動化

## チェックリスト

### リリース前チェックリスト

- [ ] 全テストがパス
- [ ] CHANGELOGを更新
- [ ] バージョン番号を更新
- [ ] リリースノートを作成
- [ ] セキュリティスキャン実施
- [ ] 依存関係の確認

### リリース後チェックリスト

- [ ] 本番環境で動作確認
- [ ] モニタリング開始
- [ ] リリースアナウンス
- [ ] Issueのクローズ
- [ ] 次期マイルストーン設定

## トラブルシューティング

### デプロイ失敗時

1. エラーログの確認
2. ロールバック判断
3. 修正版の準備
4. 再デプロイ

### 重大なバグ発見時

1. 影響範囲の特定
2. ホットフィックス判断
3. 緊急対応チーム招集
4. 修正・テスト・リリース

## 参考資料

- [セマンティックバージョニング](./セマンティックバージョニング.md)
- [開発運用フロー](./開発運用フロー.md)
- [Cloudflare Workers デプロイガイド](https://developers.cloudflare.com/workers/)