# ADR-001: VRT(Visual Regression Testing)システムの削除

- **ステータス**: 承認済
- **日付**: 2025-01-09

## コンテキスト (Context)

### 背景

プロジェクトでは、UI品質担保のためにVRT(Visual Regression Testing)システムを導入していました。このシステムは以下の構成要素で構成されていました：

- **storybook-addon-vis**: StorybookベースのVRTアドオン
- **GitHub Actions**: 自動VRT実行ワークフロー
- **ベースライン管理**: コンポーネントのビジュアル基準画像管理
- **統合テスト**: 開発フローへの組み込み

### 問題の発見

VRT運用中に以下の課題が明らかになりました：

1. **真のビジュアルテストの欠如**
   - Chromaticなしでの実装では、DOM依存のテストに留まる
   - 実際の描画結果ではなく、DOM構造の比較が中心
   - 本来のVRTの目的（視覚的変化の検出）を達成できない

2. **技術的制約**
   - storybook-addon-visの機能限界
   - ブラウザ環境差異への対応困難
   - 信頼性のあるビジュアル比較の実現困難

3. **運用コスト**
   - 頻繁な偽陽性（False Positive）
   - ベースライン管理の複雑性
   - 開発フローへの負荷

4. **品質担保の観点**
   - 期待した品質向上効果が得られない
   - 他のテスト手法との重複
   - リソースの非効率な使用

## 意思決定 (Decision)

**VRT(Visual Regression Testing)システムを完全に削除し、代替的な品質担保戦略に移行する。**

### 削除対象
- GitHub Actions VRTワークフロー
- storybook-addon-vis依存関係
- VRT設定ファイル（vitest.visual.config.ts等）
- VRTテストファイル
- VRT関連ドキュメント（10ファイル）
- VRT実行スクリプト（4ファイル）
- Storybook設定からVRTアドオン削除
- ストーリーファイルからVRT設定削除

### 代替的品質担保戦略
1. **ユニットテスト**: ロジック・バリデーション・エラーハンドリング・UIコンポーネント
2. **最小限のE2Eテスト**: 正常系の主要ユーザーフロー
3. **手動確認**: レスポンシブ・アクセシビリティ・パフォーマンス

## 検討した選択肢 (Considered Options)

### 選択肢1: Chromaticの導入
- **利点**: 真のビジュアルテストが可能
- **欠点**: 有料サービス、コスト負担
- **結論**: 個人プロジェクトにはコスト面で不適切

### 選択肢2: 他のVRTツールへの移行
- **候補**: Playwright Visual Testing、Puppeteer等
- **利点**: より高精度なビジュアル比較
- **欠点**: 新たな学習コスト、設定複雑性
- **結論**: 現在の開発リソースでは過剰

### 選択肢3: 現行VRTの改善
- **利点**: 既存投資の活用
- **欠点**: 根本的な技術制約は解決されない
- **結論**: 効果に対してコストが見合わない

### 選択肢4: VRT完全削除（採用）
- **利点**: 
  - 明確なテスト戦略
  - 運用コストの削減
  - 開発効率の向上
- **欠点**: 
  - ビジュアルテストの自動化を諦める
  - 手動確認への依存度増加
- **結論**: 現状最適解

## 結果 (Consequences)

### 正の影響
- **開発効率の向上**: VRT関連の設定・保守作業が不要
- **明確な品質担保**: 各テスト手法の役割が明確
- **技術的負債の削減**: 機能しないツールの維持コスト削減
- **フォーカス**: 本質的な品質向上への集中

### 負の影響と対策
- **ビジュアル変化の検出**: 手動確認での代替
- **リグレッション検出**: E2Eテストとユニットテストで補完
- **品質担保の一部手動化**: 開発プロセスでの手動確認強化

### 今後の方針
1. **ユニットテストの活用強化**: コンポーネントテストの拡充
2. **E2Eテストの最適化**: 正常系フローの確実な自動化
3. **手動確認の体系化**: チェックリストの作成・運用
4. **将来的な再評価**: Chromatic導入の検討（コスト効果の見直し）

## 関連ドキュメント

- [テストガイド](../テスト/テストガイド.md)
- [Issue #170: VRTシステム削除](https://github.com/ryosuke-horie/saifuu/issues/170)
- [PR #171: VRTシステム削除実装](https://github.com/ryosuke-horie/saifuu/pull/171)

## 更新履歴

- 2025-01-09: 初版作成（VRT削除決定の記録）