# 技術スタック

## 概要

Saifuuプロジェクトは、モダンなWebテクノロジーを活用し、エッジコンピューティングを中心としたアーキテクチャで構築されています。

## コア技術

### フロントエンド

#### フレームワーク・ランタイム
- **Next.js 15**
  - App Routerを採用
  - React Server Components対応
  - エッジランタイム最適化
  - バージョン: 15.3.4

- **React 19**
  - 最新の並行機能を活用
  - Suspense/Error Boundaryの活用
  - バージョン: 19.1.0

- **TypeScript 5**
  - Strict modeで型安全性を確保
  - 最新の型機能を活用

#### スタイリング
- **Tailwind CSS v4**
  - PostCSSプラグインとして導入（@tailwindcss/postcss）
  - ユーティリティファーストアプローチ
  - カスタムデザインシステム対応

#### デプロイメント
- **Cloudflare Workers**
  - OpenNext経由でNext.jsをエッジ対応
  - グローバルCDN配信
  - 低レイテンシ実現

### バックエンド（API）

#### フレームワーク
- **Hono 4.8.3**
  - 軽量・高速なWebフレームワーク
  - Cloudflare Workers最適化
  - TypeScript完全対応

#### データベース
- **Cloudflare D1**
  - SQLiteベースのエッジデータベース
  - 自動レプリケーション
  - SQLite互換API

#### ORM
- **Drizzle ORM 0.44.2**
  - TypeScript型安全
  - SQLiteアダプター使用
  - マイグレーション管理

### 開発ツール

#### ビルドツール
- **Vite**（API用）
  - 高速なビルド
  - Cloudflare Workers plugin使用
  - HMR対応

- **Next.js内蔵ビルド**（フロントエンド用）
  - Turbopackオプション対応
  - 最適化されたプロダクションビルド

#### パッケージ管理
- **npm**
  - ワークスペース機能使用
  - 依存関係の一元管理

- **mise**
  - Node.js v22のバージョン管理
  - .mise.tomlで固定

#### コード品質
- **Biome 2.0.6**
  - リンター・フォーマッター統合
  - 高速な処理
  - ESLint/Prettierの代替

### テストフレームワーク

#### ユニットテスト
- **Vitest 3.2.4**
  - Vite統合による高速実行
  - TypeScript対応
  - カバレッジレポート

#### E2Eテスト
- **Playwright 1.53.1**
  - クロスブラウザテスト
  - 並列実行対応
  - スクリーンショット/動画記録

#### コンポーネント開発
- **Storybook 8.6.14**
  - コンポーネントカタログ
  - インタラクションテスト
  - アクセシビリティチェック

#### テストユーティリティ
- **React Testing Library 16.3.0**
  - ユーザー中心のテスト
  - DOM操作の抽象化

- **MSW (Mock Service Worker) 2.10.2**
  - APIモック
  - ネットワークレベルでのインターセプト

## CI/CD & インフラ

### CI/CD
- **GitHub Actions**
  - 自動テスト実行
  - 型チェック・リント
  - 自動デプロイ

### デプロイメント
- **Cloudflare Workers**（API）
  - wranglerによるデプロイ
  - 環境変数管理
  - ゼロダウンタイムデプロイ

- **Cloudflare Workers**（フロントエンド）
  - OpenNextによる変換
  - 静的アセット最適化
  - エッジSSR

### モニタリング
- **Cloudflare Analytics**（予定）
  - パフォーマンス監視
  - エラートラッキング

## 開発環境

### 必須要件
- **Node.js 22**（miseで管理）
- **npm**（パッケージマネージャー）

### 推奨ツール
- **VS Code**
  - 推奨拡張機能設定済み
  - デバッグ設定含む

### 開発用データベース
- **SQLite**（ローカル開発）
  - dev.dbファイル
  - Drizzle Studioでの可視化

## テスト戦略

### テストピラミッド（現在の実装）
```
E2Eテスト (最小限)
    ↑
コンポーネントテスト (Storybook)
    ↑
ユニットテスト (Vitest)
```

### 砂時計型アプローチ（設計思想）
- ユニットテストと統合テストに重点
- E2Eは最小限の正常系のみ
- APIレベルでの網羅的なテスト

## セキュリティ

### 依存関係管理
- **npm audit**による脆弱性チェック
- 定期的な依存関係更新

### 環境変数
- **.env**ファイルによる管理
- Cloudflare secretsでの本番管理

## パフォーマンス最適化

### フロントエンド
- **React Server Components**
  - サーバーサイドでのコンポーネント実行
  - バンドルサイズ削減

- **Code Splitting**
  - 動的インポート活用
  - ルートベースの分割

### API
- **エッジ実行**
  - Cloudflare Workersでの低レイテンシ
  - グローバル配信

- **キャッシュ戦略**
  - 適切なCache-Control設定
  - Cloudflare CDN活用

## 技術選定の理由

### Cloudflareエコシステムの採用
- **統一されたプラットフォーム**: フロントエンド、API、データベースを一元管理
- **エッジコンピューティング**: ユーザーに近い場所での処理
- **コスト効率**: 個人プロジェクトに適した価格体系

### モダンスタックの選択
- **開発効率**: 最新ツールによる生産性向上
- **型安全性**: TypeScriptによるランタイムエラーの削減
- **保守性**: 明確な構造と豊富なドキュメント

## バージョン管理ポリシー

### メジャーバージョン更新
- 四半期ごとに検討
- 破壊的変更は慎重に評価

### セキュリティアップデート
- 即座に適用
- CI/CDでの自動チェック

## 今後の技術検討

### 検討中の技術
- **Bun**: Node.js代替ランタイム
- **tRPC**: 型安全なAPI通信
- **Zustand**: 状態管理の簡素化

### 長期的な展望
- **PWA対応**: オフライン機能
- **WebAssembly**: パフォーマンスクリティカルな処理
- **AI統合**: 支出パターン分析