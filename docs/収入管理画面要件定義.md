# 収入管理画面要件定義

## 1. 概要

本ドキュメントは、Saifuu家計管理アプリケーションにおける収入管理機能の要件を定義します。
既存の支出管理機能のパターンを踏襲し、収入の記録・管理・分析機能を提供します。

## 2. 機能要件

### 2.1 基本機能（CRUD操作）

- **収入登録**: 新規収入データの登録
  - 金額（必須、正の数値のみ）
  - 日付（必須、カレンダー選択）
  - カテゴリ（必須、ドロップダウン選択）
  - 説明・メモ（任意、最大500文字）
  - 定期収入フラグ（任意、トグルスイッチ）

- **収入編集**: 登録済み収入データの修正
- **収入削除**: 不要な収入データの削除（確認ダイアログ表示）
- **収入一覧**: 登録済み収入の一覧表示
  - ページネーション対応
  - ソート機能（日付、金額）

### 2.2 フィルタリング機能

- **期間フィルタ**
  - 今月
  - 先月
  - 今年
  - カスタム期間（開始日・終了日指定）

- **カテゴリフィルタ**
  - 全カテゴリ
  - 個別カテゴリ選択

- **金額範囲フィルタ**
  - 最小金額・最大金額指定

### 2.3 統計・分析機能

- **収入統計カード**
  - 今月の収入合計
  - 先月の収入合計
  - 前月比増減率
  - 今年の収入合計

- **カテゴリ別内訳**
  - 円グラフまたは棒グラフ表示
  - カテゴリ別収入額・割合

### 2.4 収入固有機能

- **定期収入管理**
  - 毎月の給与等、定期的な収入の自動記録設定
  - 定期収入の一時停止・再開機能

- **源泉徴収対応**
  - 手取り額と総支給額の管理
  - 源泉徴収税額の記録（オプション）

- **賞与管理**
  - 賞与の個別登録
  - 年間賞与合計の表示

### 2.5 支出機能との統合

- **収支バランス表示**
  - ダッシュボードでの収入・支出の対比表示
  - 月別・年別の純利益（収入 - 支出）計算

- **統合レポート**
  - 収入・支出・貯蓄率の包括的な分析
  - トレンドグラフ表示

## 3. UI/UX要件

### 3.1 画面構成

- **ルーティング**: `/income` （支出管理の `/expenses` と並列）
- **ナビゲーション**: ヘッダーに「収入管理」メニュー追加（アイコン: 💰）
- **レイアウト**: 3セクション構成
  1. 収入統計カード（上部）
  2. フィルタリングコントロール（中部）
  3. 収入一覧テーブル（下部）

### 3.2 収入カテゴリ

| カテゴリID | カテゴリ名 | 説明 |
|-----------|-----------|------|
| 101 | 給与 | 毎月の給与所得 |
| 102 | ボーナス | 賞与・特別手当 |
| 103 | 副業 | 副業による収入 |
| 104 | 投資収益 | 株式配当・利息等 |
| 105 | その他 | その他の収入 |

### 3.3 ビジュアルデザイン

- **カラースキーム**: 緑系統（text-green-600、bg-green-50）
  - 支出の赤系統と明確に区別
- **アイコン**: プラス記号（+）、上向き矢印（↑）
- **グラデーション**: green-to-emerald

### 3.4 レスポンシブデザイン

- モバイルファースト設計
- 既存の支出管理と同様のレスポンシブパターン
- タッチフレンドリーなボタン配置

## 4. データモデル要件

### 4.1 スキーマ変更

```typescript
// transactions テーブルの type enum を拡張
type: ['expense', 'income'] // 現在は ['expense'] のみ
```

### 4.2 収入カテゴリ定義

```typescript
// shared/config/categories.ts の INCOME_CATEGORIES 配列を定義
export const INCOME_CATEGORIES = [
  { id: 'salary', name: '給与', icon: '💰', numericId: 101 },
  { id: 'bonus', name: 'ボーナス', icon: '🎁', numericId: 102 },
  { id: 'side_business', name: '副業', icon: '💼', numericId: 103 },
  { id: 'investment', name: '投資収益', icon: '📈', numericId: 104 },
  { id: 'other_income', name: 'その他', icon: '💸', numericId: 105 },
];
```

### 4.3 バリデーションルール

- 金額: 正の数値のみ（収入の場合）
- カテゴリID: 101-105の範囲（収入カテゴリ）
- タイプ: 'income' 必須

## 5. API要件

### 5.1 エンドポイント

既存の `/api/transactions` エンドポイントを拡張:

- `GET /api/transactions?type=income` - 収入一覧取得
- `POST /api/transactions` - 収入登録（type: 'income'）
- `PUT /api/transactions/:id` - 収入更新
- `DELETE /api/transactions/:id` - 収入削除

### 5.2 統計エンドポイント

- `GET /api/transactions/stats?type=income` - 収入統計取得

## 6. 実装方針

### 6.1 再利用コンポーネント

以下の既存コンポーネントを収入用に拡張:
- `ExpenseForm` → `IncomeForm`
- `ExpenseList` → `IncomeList`
- `ExpenseStats` → `IncomeStats`
- `ExpenseFilters` → `IncomeFilters`

### 6.2 共通化

- トランザクション型の統一（TransactionType）
- フォームバリデーションスキーマの共通化
- APIクライアントの共通化

### 6.3 段階的実装

1. **Phase 1**: 基本的なCRUD機能
2. **Phase 2**: フィルタリング・統計機能
3. **Phase 3**: 支出との統合・分析機能

## 7. テスト要件

### 7.1 ユニットテスト

- 収入フォームのバリデーション
- 金額計算ロジック
- カテゴリフィルタリング

### 7.2 統合テスト

- API エンドポイントの動作確認
- データベースとの連携

### 7.3 E2Eテスト

- 収入登録の正常フロー（最小限）

## 8. 非機能要件

### 8.1 パフォーマンス

- 収入一覧の表示: 2秒以内
- フィルタリング応答: 500ms以内

### 8.2 セキュリティ

- 金額の改ざん防止
- SQLインジェクション対策

### 8.3 アクセシビリティ

- キーボード操作対応
- スクリーンリーダー対応
- 適切なARIAラベル

## 9. 今後の拡張性

- CSVエクスポート機能
- 確定申告用データ出力
- 収入予測・目標設定機能
- 複数通貨対応

## 10. 参考資料

- [支出管理機能の実装](./プロジェクト概要.md#主要機能)
- [技術スタック](./技術スタック.md)
- [データベース設計](./プロジェクト構造.md#データベース)