# フロントエンド アーキテクチャ

## 概要

Saifuuのフロントエンドは、Next.js 15のApp Routerを基盤とし、Cloudflare Workersで動作する高性能な家計管理アプリケーションです。

## 設計思想

### 1. コンポーネント駆動開発（CDD）
- 独立したコンポーネント開発
- UIロジックとビジネスロジックの明確な分離
- 再利用可能で保守性の高いコンポーネント設計

### 2. 型安全性の確保
- TypeScriptによる完全な型定義
- Zodによるランタイムバリデーション
- 型推論を最大限活用した開発者体験の向上

### 3. パフォーマンス最適化
- Server Componentsの積極的活用
- 適切なキャッシュ戦略
- バンドルサイズの最小化

## アーキテクチャ構成

### レイヤー構造

```
┌─────────────────────────────────────────┐
│         Presentation Layer              │
│  (Components, Pages, Layouts)           │
├─────────────────────────────────────────┤
│         Application Layer               │
│  (Hooks, State Management, Actions)     │
├─────────────────────────────────────────┤
│         Domain Layer                    │
│  (Types, Validation, Business Logic)    │
├─────────────────────────────────────────┤
│         Infrastructure Layer            │
│  (API Client, Logger, External Services)│
└─────────────────────────────────────────┘
```

### ディレクトリ構造と責務

#### `/app` - ルーティングとページ
- Next.js App Routerによるファイルベースルーティング
- ページコンポーネントとレイアウト
- メタデータとSEO設定

#### `/components` - 再利用可能なUIコンポーネント
```
components/
├── common/       # 汎用コンポーネント（Button, Input等）
├── features/     # 機能別コンポーネント
│   ├── expenses/    # 支出関連
│   ├── income/      # 収入関連
│   └── subscriptions/ # サブスク関連
└── layouts/      # レイアウトコンポーネント
```

#### `/hooks` - カスタムフック
- データフェッチング用フック
- 状態管理用フック
- ユーティリティフック

#### `/lib` - 共通ライブラリ
```
lib/
├── api/          # APIクライアント
├── logger/       # ロギングシステム
├── utils/        # ユーティリティ関数
└── validations/  # バリデーションスキーマ
```

## データフロー

### 1. Server Components → Client Components
```typescript
// Server Component (データフェッチング)
async function ExpensePage() {
  const expenses = await fetchExpenses();
  return <ExpenseList expenses={expenses} />;
}

// Client Component (インタラクション)
'use client';
function ExpenseList({ expenses }) {
  // インタラクティブな処理
}
```

### 2. 状態管理パターン
- **ローカル状態**: useState、useReducer
- **サーバー状態**: React Query風のカスタムフック
- **グローバル状態**: Context API（最小限）

### 3. API通信
```typescript
// APIクライアントの使用例
const { data, error, isLoading } = useExpenses({
  month: currentMonth,
  category: selectedCategory,
});
```

## セキュリティ考慮事項

### 1. クライアントサイド
- XSS対策（Reactのデフォルト保護）
- 適切なCSP設定
- センシティブ情報の非露出

### 2. 認証・認可
- HTTPOnly Cookieによるセッション管理
- CSRFトークンの実装
- 適切なCORS設定

## パフォーマンス戦略

### 1. レンダリング最適化
- Server Componentsの活用
- 適切なSuspense境界の設定
- 動的インポートによるコード分割

### 2. データフェッチング
- 並列フェッチングの活用
- 適切なキャッシュ戦略
- オプティミスティックアップデート

### 3. アセット最適化
- 画像の最適化（next/image）
- フォントの最適化（next/font）
- CSSの最小化

## エラーハンドリング

### 1. エラー境界
```typescript
// app/error.tsx
export default function Error({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return <ErrorComponent error={error} onReset={reset} />;
}
```

### 2. APIエラー処理
- 統一されたエラーフォーマット
- 適切なエラーメッセージの表示
- リトライ機構の実装

## 開発環境

### 必須ツール
- Node.js 22（mise経由）
- Ghost（バックグラウンドプロセス管理）

### 推奨設定
- VSCode + 推奨拡張機能
- Biomeによるコード品質管理
- Git Hooksによる自動チェック