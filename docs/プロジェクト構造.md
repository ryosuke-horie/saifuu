# プロジェクト構造

## 概要

Saifuuプロジェクトは、モノレポ構造で管理されており、フロントエンド、API、E2Eテスト、共有コード、ドキュメントが明確に分離されています。

## ルートディレクトリ構造

```
saifuu/
├── api/                    # バックエンドAPI（Hono + Cloudflare Workers）
├── frontend/              # フロントエンドアプリケーション（Next.js）
├── e2e/                   # エンドツーエンドテスト（Playwright）
├── shared/                # 共有ユーティリティと設定
├── docs/                  # プロジェクトドキュメント（日本語）
├── .kiro/                 # AIツール設定（移行予定）
├── package.json           # ルートパッケージ設定
├── .mise.toml            # Node.jsバージョン管理
├── README.md             # プロジェクト概要
└── CLAUDE.md             # AI開発ガイドライン
```

## 詳細構造

### API（`api/`）

```
api/
├── src/
│   ├── routes/            # APIエンドポイントハンドラー
│   │   ├── categories.ts  # カテゴリ管理API
│   │   ├── subscriptions.ts # サブスクリプションAPI
│   │   └── transactions.ts # 取引API
│   ├── db/                # データベース設定
│   │   ├── schema.ts      # Drizzle ORMスキーマ定義
│   │   ├── index.ts       # 開発環境DB接続
│   │   └── index-d1.ts    # Cloudflare D1接続
│   ├── middleware/        # ミドルウェア
│   │   └── logging.ts     # ロギングミドルウェア
│   ├── logger/            # ロガー実装
│   │   ├── factory.ts     # ロガーファクトリ
│   │   ├── cloudflare-logger.ts # CF専用ロガー
│   │   └── types.ts       # 型定義
│   ├── types/             # 共通型定義
│   │   ├── index.ts       # 基本型
│   │   └── subscription.ts # サブスク関連型
│   └── __tests__/         # テストファイル
│       ├── unit/          # ユニットテスト
│       ├── integration/   # 統合テスト
│       └── helpers/       # テストヘルパー
├── drizzle/
│   ├── migrations/        # DBマイグレーション
│   └── seed.sql          # 初期データ
├── scripts/               # ユーティリティスクリプト
│   ├── migrate-dev.js     # 開発環境マイグレーション
│   └── seed-categories.js # カテゴリシード
├── public/                # 静的ファイル
├── package.json          # 依存関係
├── tsconfig.json         # TypeScript設定
├── vite.config.ts        # Viteビルド設定
├── vitest.config.ts      # テスト設定
├── wrangler.jsonc        # Cloudflare設定
└── biome.json            # リンター設定
```

### フロントエンド（`frontend/`）

```
frontend/
├── src/
│   ├── app/               # Next.js App Router
│   │   ├── layout.tsx     # ルートレイアウト
│   │   ├── page.tsx       # ホームページ
│   │   ├── expenses/      # 支出管理ページ
│   │   │   └── page.tsx
│   │   ├── subscriptions/ # サブスク管理ページ
│   │   │   └── page.tsx
│   │   ├── globals.css    # グローバルスタイル
│   │   └── (エラー処理)
│   │       ├── not-found.tsx
│   │       └── global-error.tsx
│   ├── components/        # Reactコンポーネント
│   │   ├── ui/            # 基礎UIコンポーネント
│   │   │   └── Dialog.tsx
│   │   ├── expenses/      # 支出関連コンポーネント
│   │   │   ├── ExpenseForm.tsx
│   │   │   └── ExpenseList.tsx
│   │   ├── subscriptions/ # サブスク関連コンポーネント
│   │   │   ├── SubscriptionForm.tsx
│   │   │   └── SubscriptionList.tsx
│   │   └── layout/        # レイアウトコンポーネント
│   │       └── Header.tsx
│   ├── hooks/             # カスタムフック
│   │   ├── useCategories.ts
│   │   └── useExpenses.ts
│   ├── lib/               # ライブラリ・ユーティリティ
│   │   ├── api/           # APIクライアント
│   │   │   ├── client.ts  # HTTPクライアント
│   │   │   ├── categories/
│   │   │   ├── subscriptions/
│   │   │   └── hooks/     # API用フック
│   │   ├── logger/        # フロントエンドロガー
│   │   │   ├── browser-logger.ts
│   │   │   └── context.tsx
│   │   ├── utils/         # 汎用ユーティリティ
│   │   └── validation/    # バリデーション
│   │       └── form-validation.ts
│   ├── types/             # TypeScript型定義
│   ├── test-utils/        # テストユーティリティ
│   └── __tests__/         # テストファイル
├── public/                # 静的アセット
│   ├── favicon.ico
│   └── mockServiceWorker.js
├── next.config.ts        # Next.js設定
├── tailwind.config.js    # Tailwind設定
├── postcss.config.mjs    # PostCSS設定
├── tsconfig.json         # TypeScript設定
├── package.json          # 依存関係
└── wrangler.jsonc        # CF Workers設定
```

### E2Eテスト（`e2e/`）

```
e2e/
├── development/           # 開発環境用テスト
│   └── integration/       # 統合テスト
├── production/           # 本番環境用テスト
│   ├── critical-flows/   # クリティカルフロー
│   └── smoke-tests/      # スモークテスト
├── *.spec.ts             # テストファイル
├── playwright.config.ts  # Playwright設定
├── package.json          # E2E専用依存関係
└── test-results/         # テスト結果
```

### 共有コード（`shared/`）

```
shared/
└── config/
    └── categories.ts      # カテゴリ定義
```

### ドキュメント（`docs/`）

```
docs/
├── README.md              # ドキュメント目次
├── プロジェクト概要.md
├── 技術スタック.md
├── プロジェクト構造.md     # このファイル
├── API開発/               # API関連ドキュメント
├── フロントエンド開発/     # フロントエンド関連
├── データベース/          # DB関連
├── ロギング/              # ロギング実装
├── テスト/                # テストガイド
├── 開発環境/              # 環境セットアップ
├── adr/                   # アーキテクチャ決定記録
└── ci/                    # CI/CDドキュメント
```

## ファイル命名規約

### 基本ルール

| ファイルタイプ | 命名規則 | 例 |
|------------|---------|---|
| コンポーネント | PascalCase | `ExpenseForm.tsx` |
| フック | camelCase + use | `useExpenses.ts` |
| ユーティリティ | camelCase | `formatCurrency.ts` |
| 型定義 | PascalCase | `Expense.ts` |
| テスト | 元ファイル名.test | `ExpenseForm.test.tsx` |
| ドキュメント | 日本語 | `テストガイド.md` |

### ディレクトリ命名

- **機能別**: 小文字、複数形（`expenses/`, `subscriptions/`）
- **カテゴリ別**: 小文字（`ui/`, `hooks/`, `utils/`）
- **設定系**: ドット始まり（`.storybook/`, `.kiro/`）

## インポート規約

### パスエイリアス

フロントエンドでは`@/`エイリアスを使用：

```typescript
// Good
import { ExpenseForm } from '@/components/expenses/ExpenseForm';
import { useCategories } from '@/hooks/useCategories';

// Bad
import { ExpenseForm } from '../../../components/expenses/ExpenseForm';
```

### インポート順序

1. 外部ライブラリ
2. 内部エイリアス（`@/`）
3. 相対パス
4. 型のみのインポート

```typescript
// 外部ライブラリ
import React from 'react';
import { useForm } from 'react-hook-form';

// 内部エイリアス
import { Button } from '@/components/ui/Button';
import { useCategories } from '@/hooks/useCategories';

// 相対パス
import { validateAmount } from './validation';

// 型のみ
import type { Expense } from '@/types/expense';
```

## 環境別ファイル

### 開発環境
- `.env` - 環境変数
- `dev.db` - SQLiteデータベース
- `*.log` - ログファイル

### テスト環境
- `e2e-test.db` - E2E用データベース
- `test-results/` - テスト結果

### 本番環境
- Cloudflare Workersの環境変数
- Cloudflare D1データベース

## ビルド成果物

### 無視されるディレクトリ
- `node_modules/` - 依存関係
- `.next/` - Next.jsビルド
- `dist/` - APIビルド
- `coverage/` - テストカバレッジ
- `.turbo/` - Turboキャッシュ

## セキュリティ考慮事項

### 機密ファイル
- `.env` - Gitで無視
- `wrangler.toml` - 本番設定は別管理
- `*.db` - データベースファイル

### パブリックアクセス
- `public/` ディレクトリの内容は公開される
- 機密情報を配置しない

## ベストプラクティス

### コードの配置
1. **機能ごとにまとめる**: 関連ファイルは同じディレクトリに
2. **共通化は慎重に**: 早すぎる抽象化を避ける
3. **テストは近くに**: ソースコードと同じ階層に配置

### ドキュメントの配置
1. **docs/に集約**: プロジェクトドキュメントは一箇所に
2. **日本語ファイル名**: 読みやすさを重視
3. **カテゴリ分け**: 機能や目的別にサブディレクトリ

### 設定ファイル
1. **ルートに配置**: プロジェクト全体の設定
2. **各ディレクトリに配置**: モジュール固有の設定
3. **環境別に分離**: 開発/テスト/本番を明確に区別