# ビジュアルテスト操作クイックリファレンス

## 🚀 すぐに使えるコマンド集

### 基本操作

```bash
# 現在の状態確認
npm run baseline:status

# 新しいベースライン画像を作成
npm run baseline:create

# 既存のベースライン画像を更新（バックアップ付き）
npm run baseline:update

# 差分画像を確認
npm run baseline:diff

# ベースライン画像の整合性検証
npm run baseline:validate
```

### 日常的なワークフロー

#### 🆕 新しいコンポーネントを追加した時

```bash
# 1. ストーリーファイルを作成し、visual-testタグを追加
# 2. ベースライン画像を作成
npm run baseline:create

# 3. 結果を確認
npm run baseline:status

# 4. コミット
git add __vis__/
git commit -m "feat: 新しいコンポーネントのベースライン画像を追加"
```

#### 🔧 既存のコンポーネントを修正した時

```bash
# 1. ビジュアルテストを実行
npm run test:visual

# 2. 差分を確認
npm run baseline:diff

# 3. 意図した変更の場合、ベースライン更新
npm run baseline:update

# 4. コミット
git add __vis__/
git commit -m "fix: コンポーネントの視覚的修正をベースラインに反映"
```

#### 🧹 定期的なメンテナンス

```bash
# 週次実行
npm run baseline:validate  # 整合性確認
npm run baseline:clean     # 不要ファイル削除

# 月次実行
npm run baseline:backup    # バックアップ作成
```

### トラブルシューティング

#### ❌ CI で差分が検出された時

```bash
# 1. GitHub Actionsからアーティファクトをダウンロード
# 2. 差分画像を確認
# 3. 意図した変更の場合、ローカルで更新
npm run baseline:update

# 4. コミット・プッシュ
git add __vis__/
git commit -m "fix: ビジュアルテストベースライン更新"
git push
```

#### 🔄 間違ってベースラインを更新してしまった時

```bash
# バックアップ一覧を確認
./scripts/baseline-manager.sh restore

# 特定のバックアップから復元
./scripts/baseline-manager.sh restore backup_20231201_120000
```

## 🎯 シチュエーション別対応

### レスポンシブデザインの変更

```bash
# モバイル表示のみ更新
./scripts/baseline-manager.sh update --viewport mobile

# 全ビューポート更新
npm run baseline:update
```

### 特定のコンポーネントのみ更新

```bash
# Dialogコンポーネントのみ
./scripts/baseline-manager.sh update --component Dialog

# 複数コンポーネント
./scripts/baseline-manager.sh update --component Dialog
./scripts/baseline-manager.sh update --component Button
```

### 大規模な変更の場合

```bash
# 1. 事前バックアップ
npm run baseline:backup

# 2. 段階的更新
./scripts/baseline-manager.sh update --component Header
git add __vis__/ && git commit -m "fix: Headerコンポーネントベースライン更新"

./scripts/baseline-manager.sh update --component Dialog
git add __vis__/ && git commit -m "fix: Dialogコンポーネントベースライン更新"

# 3. 全体確認
npm run baseline:validate
```

## 🔧 高度な操作

### 乾燥実行（実際の変更なしで確認）

```bash
./scripts/baseline-manager.sh update --dry-run
./scripts/baseline-manager.sh clean --dry-run
```

### 強制実行（確認なし）

```bash
./scripts/baseline-manager.sh update --force
./scripts/baseline-manager.sh clean --force
```

### バックアップ付き操作

```bash
./scripts/baseline-manager.sh update --backup
./scripts/baseline-manager.sh clean --backup
```

## 📊 状態確認コマンド

```bash
# 詳細な状態表示
npm run baseline:status

# 整合性検証
npm run baseline:validate

# 差分画像の詳細
npm run baseline:diff

# バックアップ一覧
./scripts/baseline-manager.sh restore
```

## 🚨 緊急時対応

### すべてのベースラインを再作成

```bash
# 1. 現在のベースラインをバックアップ
npm run baseline:backup

# 2. ベースラインディレクトリを削除
rm -rf __vis__/

# 3. 新しいベースラインを作成
npm run baseline:create

# 4. 確認
npm run baseline:validate
```

### CIが失敗し続ける場合

```bash
# 1. ローカルでCIと同じ環境で実行
npm run ci:visual

# 2. 問題の特定
npm run baseline:validate

# 3. CI用ベースライン更新
npm run ci:baseline:update
```

## 📁 ファイル・ディレクトリ構成

```
frontend/
├── __vis__/                    # ベースライン画像（Git管理）
├── __vis_backup__/             # バックアップ（Git除外）
├── visual-test-artifacts/      # CI生成アーティファクト（Git除外）
├── visual-test.config.json     # 設定ファイル
└── scripts/
    ├── baseline-manager.sh     # メイン管理スクリプト
    └── ci-baseline-manager.sh  # CI用スクリプト
```

## 🎨 Storybookでの確認

```bash
# Storybookを起動
npm run storybook

# ブラウザで http://localhost:6006 を開く
# サイドバーで「Tags: visual-test」フィルターを使用
# ビジュアルテスト対象ストーリーのみ表示
```

## 📖 詳細情報

- [詳細ガイド](./ビジュアルテストベースライン管理ガイド.md)
- [Storybook設定ガイド](./Storybookビジュアルテスト設定ガイド.md)
- [設定ファイルリファレンス](../visual-test.config.json)

---

💡 **ヒント**: 困ったときは `npm run baseline:help` でヘルプを表示できます。